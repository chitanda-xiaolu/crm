(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c8d156e"],{"021c":function(t,e,r){},"122e":function(t,e,r){},2728:function(t,e,r){"use strict";var a=r("fc8c"),o=r.n(a);o.a},"80f1":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"product-finish-container main-box dis-flex-col"},[r("div",{ref:"wrapper",staticClass:"wrapper"},[r("el-form",{ref:"pricedataForm",attrs:{model:t.pricedataForm,"label-width":"100px"}},[r("el-divider",{attrs:{"content-position":"left"}},[t._v("订单信息"),r("i",{staticClass:"el-icon-thumb thumb"})]),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"订单编号：",prop:"a"}},[r("span",[t._v(t._s(t.orderCode))])])],1)],1),r("el-divider",{attrs:{"content-position":"left"}},[t._v("生产单信息"),r("i",{staticClass:"el-icon-thumb thumb"})]),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"审核名称：",prop:"auditName",rules:[{required:!0,message:"请输入审核名称",trigger:"blur"}]}},[r("el-input",{attrs:{placeholder:"请输入"},model:{value:t.pricedataForm.auditName,callback:function(e){t.$set(t.pricedataForm,"auditName",e)},expression:"pricedataForm.auditName"}})],1)],1),r("el-col",{attrs:{span:10}},[r("el-form-item",{attrs:{label:"总金额：",prop:"c"}},[r("span",{staticClass:"total-price"},[t._v(t._s(t.totalPrice))]),r("span",{staticClass:"total-unit"},[t._v("元")])])],1)],1),r("el-row",[r("div",{staticClass:"table-box"},[r("el-button",{staticClass:"select-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-plus",plain:""},on:{click:t.selectProduct}},[t._v("添加产品")])],1)]),r("el-row",[r("add-finish-product-table",{attrs:{defaultData:t.productLists},on:{checkFun:t.checkFlagFun}})],1),r("el-button",{directives:[{name:"show",rawName:"v-show",value:t.checkFlag,expression:"checkFlag"}],staticClass:"save-btn",attrs:{type:"primary",icon:"el-icon-s-promotion"},on:{click:function(e){return t.dataFormSubmit("pricedataForm")}}},[t._v("提交成品单")])],1)],1),r("add-finish-product-dialog",{ref:"add-finish-product-dialog",on:{selected:t.dialogEmitSelect}})],1)},o=[],i=(r("8e6e"),r("cadf"),r("456d"),r("ac6a"),r("bd86")),s=r("fa7d"),c=r("2f62"),n=r("f8b7"),l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{staticClass:"add-finish-product-dialog",attrs:{title:"选择产品",visible:t.productVisible,"append-to-body":!0,"modal-append-to-body":!1},on:{"update:visible":function(e){t.productVisible=e},open:t.openDialog}},[r("el-form",{ref:"numberValidateForm",staticClass:"add-finish-product-dialog-form",attrs:{model:t.productDateForm,"label-width":"70px",inline:!0}},[r("el-form-item",{attrs:{label:"分类：",prop:"type"}},[r("el-cascader",{staticStyle:{width:"100%"},attrs:{"change-on-select":"",placeholder:"请选择产品",clearable:"",options:t.searchProList,filterable:""},model:{value:t.productDateForm.type,callback:function(e){t.$set(t.productDateForm,"type",e)},expression:"productDateForm.type"}})],1),r("el-form-item",{attrs:{label:"名称：",prop:"kjlName"}},[r("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:t.productDateForm.kjlName,callback:function(e){t.$set(t.productDateForm,"kjlName",e)},expression:"productDateForm.kjlName"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:t.searchProducts}},[t._v("查询")])],1)],1),r("el-row",{staticClass:"select-product-container",attrs:{gutter:20}},t._l(t.productList,(function(e){return r("el-col",{key:e.id,staticClass:"product-item"},[r("div",{staticClass:"pro-top"},[r("div",{staticClass:"top-left"},[r("viewer",{staticClass:"image-preview-box"},[r("img",{attrs:{src:e.picPath}})])],1),r("div",{staticClass:"top-right"},[r("el-tooltip",{attrs:{placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.name))]),r("p",{staticClass:"text-ellipsis"},[t._v(t._s(e.name))])]),r("el-tooltip",{attrs:{placement:"right"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.kjlCode))]),r("p",{staticClass:"text-ellipsis"},[t._v(t._s(e.kjlCode))])]),r("el-tooltip",{attrs:{placement:"bottom"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.standards))]),r("p",{staticClass:"text-ellipsis"},[t._v(t._s(e.standards))])])],1)]),r("div",{staticClass:"pro-bottom"},[r("span",{staticClass:"pro-price"},[r("span",{staticClass:"price-pre"},[t._v("¥"),r("span",{staticClass:"price-num"},[t._v(t._s(e.retailPrice))])])]),r("el-checkbox-group",{on:{change:t.handleChangeAddProducts},model:{value:t.checkList,callback:function(e){t.checkList=e},expression:"checkList"}},[r("el-checkbox",{staticClass:"font-weight:normal",attrs:{label:e}},[t._v("加入生产单")])],1)],1)])})),1),r("div",{staticClass:"pagination-box"},[r("el-pagination",{attrs:{"current-page":t.productDateForm.current,"page-size":t.productDateForm.size,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.productDateForm,"current",e)},"update:current-page":function(e){return t.$set(t.productDateForm,"current",e)}}})],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmitProducts}},[t._v("确定")])],1)],1)},u=[];function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){Object(i["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var m={name:"addFinishProductDialog",data:function(){return{productVisible:!1,productList:[],searchProList:[],selectedProductLists:[],total:0,productDateForm:{type:"",kjlName:"",code:"",size:9,current:1,status:0},checkList:[]}},methods:{getProductList:function(){var t=this;Object(n["D"])(Object(s["e"])(this.productDateForm)).then((function(e){if(200===e.code&&e.success)if(t.total=e.data.total,e.data.records){var r=e.data.records;r&&r.map((function(t){t.num=1})),t.productList=r}else t.productList.length=0}))},getSerachProductsData:function(){var t=this;Object(n["db"])({productType:10001,status:0}).then((function(e){200===e.code&&e.success&&(t.searchProList=e.data)}))},searchProducts:function(){"string"===typeof this.productDateForm.type?this.productDateForm.type=this.productDateForm.type:this.productDateForm.type=this.productDateForm.type.pop(),this.getProductList()},handleChangeAddProducts:function(t){this.selectedProductLists=t},handleSubmitProducts:function(){this.selectedProductLists.length?(this.$emit("selected",{data:[].concat(this.selectedProductLists.map((function(t){return p({},t,{num:1})})))}),this.closeDialog()):this.$message({message:"您暂未选择一个产品",type:"warning"})},openDialog:function(){this.productVisible=!0,this.getProductList(),this.getSerachProductsData()},closeDialog:function(){this.productVisible=!1,this.$emit("finish")},handleCurrentChange:function(t){this.productDateForm.current=t,this.getProductList()}}},h=m,f=(r("2728"),r("2877")),b=Object(f["a"])(h,l,u,!1,null,"401be972",null),g=b.exports,P=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-table",{ref:"multipleTable",attrs:{data:t.defaultData,border:""},on:{"selection-change":t.handleSelectionChange}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),r("el-table-column",{attrs:{type:"selection",width:"55"}}),r("el-table-column",{attrs:{prop:"kjlName",label:"产品名称",width:"130"}}),r("el-table-column",{attrs:{prop:"typeName",label:"分类",width:"130"}}),r("el-table-column",{attrs:{prop:"standards",label:"规格",width:"130"}}),r("el-table-column",{attrs:{prop:"unitName",label:"单位",width:"80"}}),r("el-table-column",{attrs:{prop:"retailPrice",label:"单价（元）",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",{staticClass:"table-money"},[t._v(t._s(t.renderMoney(e.row.retailPrice)||0))])]}}])}),r("el-table-column",{attrs:{prop:"num",label:"数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-input",{attrs:{size:"small",type:"number",placeholder:"请输入"},on:{input:function(r){return t.handleEdit(e.$index,e.row)}},model:{value:e.row.num,callback:function(r){t.$set(e.row,"num",r)},expression:"scope.row.num"}})]}}])}),r("el-table-column",{attrs:{prop:"aa",label:"合计金额（元）",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",{staticClass:"table-money"},[t._v(t._s(t.renderMoney(e.row.retailPrice*e.row.num)||0))])]}}])}),t._e(),t._e(),r("el-table-column",{attrs:{prop:"description",label:"备注"}})],1)],1)},v=[],y={name:"addFinishProduct",props:{defaultData:{type:Array,default:function(){return[]}}},data:function(){return{totalPprice:0,totalSupplyPrice:0,totalNominalSettlementPrice:0}},watch:{defaultData:function(){this.handleCheckData()}},methods:{handleEdit:function(t,e){parseInt(e.num)<0&&(e.num=0)},handleSelectionChange:function(t){this.$emit("checkFun",Boolean(t.length)),this.defaultData.forEach((function(t){t.selected=!1})),t.forEach((function(t){t.selected=!0}))},handleCheckData:function(){var t=this;this.defaultData.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e,!0)}))}}},w=y,C=(r("d892"),Object(f["a"])(w,P,v,!1,null,null,null)),O=C.exports,F=r("1172");function D(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?D(Object(r),!0).forEach((function(e){Object(i["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var j={name:"addFinishProduct",components:{addFinishProductDialog:g,addFinishProductTable:O},data:function(){return{orderId:this.$route.params.orderId,orderCode:this.$route.params.orderCode,pricedataForm:{auditName:""},checkFlag:!1,productLists:[]}},computed:{totalPrice:function(){for(var t=0,e=this.productLists.length,r=0;r<e;r++)this.productLists[r].selected&&(t+=this.productLists[r].num*this.productLists[r].retailPrice);return t},totalSupplyPrice:function(){for(var t=0,e=this.productLists.length,r=0;r<e;r++)this.productLists[r].selected&&(t+=this.productLists[r].num*this.productLists[r].supplyPrice);return t},totalNominalSettlementPrice:function(){for(var t=0,e=this.productLists.length,r=0;r<e;r++)this.productLists[r].selected&&(t+=this.productLists[r].num*this.productLists[r].nominalSettlementPrice);return t}},mounted:function(){Object(F["a"])(this.$refs.wrapper)},methods:_({},Object(c["c"])({closeCurrentPage:"CLOSE_CURRENT_PAGE"}),{selectProduct:function(t){this.$refs["add-finish-product-dialog"].openDialog()},dialogEmitSelect:function(t){var e=this,r=t.data;r instanceof Array&&r.forEach((function(t){var r=Object(s["h"])(e.productLists,t.id);-1!==r?e.updateProduct(r,"num",e.productLists[r].num+t.num):e.createProduct(t)}))},updateProduct:function(t,e,r){this.productLists[t]&&this.$set(this.productLists[t],e,r)},createProduct:function(t){t.selected=!1,this.productLists.push(t)},checkFlagFun:function(t){this.checkFlag=t},dataFormSubmit:function(){var t=this,e=[];t.productLists&&t.productLists.map((function(t){t.selected&&e.push({productLibId:t.id,count:t.num,retailPrice:t.retailPrice,supplyPrice:t.supplyPrice||0,nominalSettlementPrice:t.nominalSettlementPrice,retailPriceUnit:t.retailPrice*t.num,supplyPriceUnit:t.supplyPrice*t.num,nominalSettlementPriceUnit:t.nominalSettlementPrice*t.num})}));var r={orderId:t.orderId,kjlAuditName:t.pricedataForm.auditName,totalRetailPrice:t.totalPrice,productLibs:JSON.stringify(e),totalSupplyPrice:t.totalSupplyPrice,totalNominalSettlementPrice:t.totalNominalSettlementPrice};t.$refs["pricedataForm"].validate((function(e){e&&Object(n["a"])(r).then((function(e){200===e.code&&e.success&&(t.$message.success("操作成功"),t.closeCurrentPage(t.$route.fullPath),t.$router.push({path:"/order/editCad/".concat(t.orderId,"/1")}))}))}))}})},k=j,L=(r("d32e"),Object(f["a"])(k,a,o,!1,null,"2a188f4c",null));e["default"]=L.exports},d32e:function(t,e,r){"use strict";var a=r("021c"),o=r.n(a);o.a},d892:function(t,e,r){"use strict";var a=r("122e"),o=r.n(a);o.a},fc8c:function(t,e,r){}}]);