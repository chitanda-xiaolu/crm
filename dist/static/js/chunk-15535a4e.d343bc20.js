(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-15535a4e"],{"0862":function(t,e,i){"use strict";var r=i("473b"),o=i.n(r);o.a},"0e5b":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"product-finish-container main-box dis-flex-col"},[i("div",{ref:"wrapper",staticClass:"wrapper"},[i("el-form",{ref:"pricedataForm",attrs:{model:t.pricedataForm,"label-width":"100px"}},[i("el-divider",{attrs:{"content-position":"left"}},[t._v("订单信息"),i("i",{staticClass:"el-icon-thumb thumb"})]),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"订单编号：",prop:"orderCode"}},[i("span",[t._v(t._s(t.pricedataForm.orderCode))])])],1)],1),i("el-divider",{attrs:{"content-position":"left"}},[t._v("生产单信息"),i("i",{staticClass:"el-icon-thumb thumb"})]),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"审核名称：",prop:"kjlAuditName",rules:[{required:!0,message:"请输入审核名称",trigger:"blur"}]}},[i("el-input",{attrs:{placeholder:"请输入"},model:{value:t.pricedataForm.kjlAuditName,callback:function(e){t.$set(t.pricedataForm,"kjlAuditName",e)},expression:"pricedataForm.kjlAuditName"}})],1)],1),i("el-col",{attrs:{span:10}},[i("el-form-item",{attrs:{label:"总金额：",prop:"c"}},[i("span",{staticClass:"total-price"},[t._v(t._s(t.totalPrice))]),i("span",{staticClass:"total-unit"},[t._v("元")])])],1)],1),i("el-row",[i("div",{staticClass:"table-box"},[i("el-button",{staticClass:"select-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-plus",plain:""},on:{click:t.selectProduct}},[t._v("添加产品")])],1)]),i("el-row",[t.flag?i("edit-finish-product-table",{attrs:{productLists:t.productLists},on:{tableSelectChange:t.tableEmitSelectChange}}):t._e()],1),i("el-button",{staticClass:"save-btn",attrs:{type:"primary",size:"mini",icon:"el-icon-s-promotion"},on:{click:function(e){return t.dataFormSubmit("pricedataForm")}}},[t._v("保存")])],1)],1),i("edit-finish-product-dialog",{ref:"edit-finish-product-dialog",on:{selected:t.dialogEmitSelect}})],1)},o=[],a=(i("8e6e"),i("cadf"),i("456d"),i("ac6a"),i("bd86")),c=i("fa7d"),l=i("2f62"),s=i("f8b7"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"add-finish-product-dialog",attrs:{title:"选择产品",visible:t.productVisible,"append-to-body":!0,"modal-append-to-body":!1},on:{"update:visible":function(e){t.productVisible=e},open:t.openDialog}},[i("el-form",{ref:"numberValidateForm",staticClass:"add-finish-product-dialog-form",attrs:{model:t.productDateForm,"label-width":"100px",inline:!0}},[i("el-form-item",{attrs:{label:"分类：",prop:"type"}},[i("el-cascader",{staticStyle:{width:"100%"},attrs:{"change-on-select":"",placeholder:"请选择产品",clearable:"",options:t.searchProList,filterable:""},model:{value:t.productDateForm.type,callback:function(e){t.$set(t.productDateForm,"type",e)},expression:"productDateForm.type"}})],1),i("el-form-item",{attrs:{label:"名称：",prop:"kjlName"}},[i("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:t.productDateForm.kjlName,callback:function(e){t.$set(t.productDateForm,"kjlName",e)},expression:"productDateForm.kjlName"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.searchProducts}},[t._v("查询")])],1)],1),i("el-row",{staticClass:"select-product-container"},t._l(t.productList,(function(e){return i("el-col",{key:e.id,staticClass:"product-item"},[i("div",{staticClass:"pro-top"},[i("div",{staticClass:"top-left"},[i("viewer",{staticClass:"image-preview-box"},[i("img",{attrs:{src:e.picPath}})])],1),i("div",{staticClass:"top-right"},[i("el-tooltip",{attrs:{placement:"top"}},[i("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.name))]),i("p",{staticClass:"text-ellipsis"},[t._v(t._s(e.name))])]),i("el-tooltip",{attrs:{placement:"right"}},[i("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.kjlCode))]),i("p",{staticClass:"text-ellipsis"},[t._v(t._s(e.kjlCode))])]),i("el-tooltip",{attrs:{placement:"bottom"}},[i("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.standards))]),i("p",{staticClass:"text-ellipsis"},[t._v(t._s(e.standards))])])],1)]),i("div",{staticClass:"pro-bottom"},[i("span",{staticClass:"pro-price"},[i("span",{staticClass:"price-pre"},[t._v("¥"),i("span",{staticClass:"price-num"},[t._v(t._s(e.retailPrice))])])]),i("el-checkbox-group",{on:{change:t.handleChangeAddProducts},model:{value:t.checkList,callback:function(e){t.checkList=e},expression:"checkList"}},[i("el-checkbox",{staticClass:"font-weight:normal",attrs:{label:e}},[t._v("加入生产单")])],1)],1)])})),1),i("div",{staticClass:"pagination-box"},[i("el-pagination",{attrs:{"current-page":t.productDateForm.current,"page-size":t.productDateForm.size,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.productDateForm,"current",e)},"update:current-page":function(e){return t.$set(t.productDateForm,"current",e)}}})],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmitProducts}},[t._v("确定")])],1)],1)},u=[];function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(a["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h={name:"editFinishProductDialog",data:function(){return{productVisible:!1,productList:[],searchProList:[],selectedProductLists:[],productDateForm:{type:"",kjlName:"",code:"",size:9,current:1,stauts:0},total:0,checkList:[]}},methods:{getProductList:function(){var t=this;Object(s["D"])(Object(c["e"])(this.productDateForm)).then((function(e){if(200===e.code&&e.success)if(t.total=e.data.total,e.data.records){var i=e.data.records;i&&i.map((function(t){t.count=1})),t.productList=i}else t.productList.length=0}))},getSerachProductsData:function(){var t=this;Object(s["db"])({productType:10001,status:0}).then((function(e){200===e.code&&e.success&&(t.searchProList=e.data)}))},searchProducts:function(){"string"===typeof this.productDateForm.type?this.productDateForm.type=this.productDateForm.type:this.productDateForm.type=this.productDateForm.type.pop(),this.getProductList()},handleChangeAddProducts:function(t){this.selectedProductLists=t},handleSubmitProducts:function(){this.$emit("selected",{data:[].concat(this.selectedProductLists.map((function(t){return d({},t,{num:1})})))}),this.closeDialog()},openDialog:function(){this.getProductList(),this.getSerachProductsData(),this.productVisible=!0},closeDialog:function(){this.productVisible=!1,this.$emit("finish")},handleCurrentChange:function(t){this.productDateForm.current=t,this.getProductList()}}},m=h,f=(i("1d8f"),i("2877")),b=Object(f["a"])(m,n,u,!1,null,"6710e510",null),P=b.exports,g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-table",{ref:"table",attrs:{data:t.productLists,border:""},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),i("el-table-column",{attrs:{type:"selection",width:"55",selectable:function(){return!0}}}),i("el-table-column",{attrs:{prop:"name",label:"产品名称",width:"130"}}),i("el-table-column",{attrs:{prop:"typeName",label:"分类",width:"170"}}),i("el-table-column",{attrs:{prop:"standards",label:"规格",width:"130"}}),i("el-table-column",{attrs:{prop:"unitName",label:"单位",width:"80"}}),i("el-table-column",{attrs:{prop:"retailPrice",label:"单价（元）",width:"100"}}),i("el-table-column",{attrs:{prop:"count",label:"数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-input",{attrs:{size:"small",type:"number",placeholder:"请输入"},on:{input:function(i){return t.handleEdit(e.$index,e.row)}},model:{value:e.row.count,callback:function(i){t.$set(e.row,"count",i)},expression:"scope.row.count"}})]}}])}),i("el-table-column",{attrs:{prop:"aa",label:"合计金额（元）",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"table-money"},[t._v(t._s(t.renderMoney(e.row.retailPrice*e.row.count)||0))])]}}])}),t._e(),t._e(),i("el-table-column",{attrs:{prop:"description",label:"备注"}})],1)],1)},y=[],v={name:"editFinishProduct",props:["productLists"],data:function(){return{totalPprice:0,totalSupplyPrice:0,totalNominalSettlementPrice:0,arr:[]}},updated:function(){this.checkedAllProgramList()},methods:{handleEdit:function(t,e){parseInt(e.count)<0&&(e.count=0),this.clacTotalPrice(),this.calcTotalNominalSettlementPrice(),this.calcTotalSupplyPrice(),this.$emit("tableSelectChange",{totalPrice:this.totalPprice,totalSupplyPrice:this.totalSupplyPrice,totalNominalSettlementPrice:this.totalNominalSettlementPrice})},checkedAllProgramList:function(t){var e=this;e.productLists&&e.productLists.map((function(t){e.$refs&&e.$refs.table.toggleRowSelection(t,!0)}))},handleSelectionChange:function(t){this.multipleSelection=t,this.clacTotalPrice(),this.calcTotalNominalSettlementPrice(),this.calcTotalSupplyPrice(),this.$emit("tableSelectChange",{totalPrice:this.totalPprice,totalSupplyPrice:this.totalSupplyPrice,totalNominalSettlementPrice:this.totalNominalSettlementPrice,tablePro:t})},clacTotalPrice:function(){for(var t=0,e=this.multipleSelection.length,i=0;i<e;i++)t+=this.multipleSelection[i].count*this.multipleSelection[i].retailPrice;this.totalPprice=t},calcTotalSupplyPrice:function(){for(var t=0,e=this.multipleSelection.length,i=0;i<e;i++)this.multipleSelection[i].supplyPrice?t+=this.multipleSelection[i].count*this.multipleSelection[i].supplyPrice:t=0;this.totalSupplyPrice=t},calcTotalNominalSettlementPrice:function(){for(var t=0,e=this.multipleSelection.length,i=0;i<e;i++)t+=this.multipleSelection[i].count*this.multipleSelection[i].nominalSettlementPrice;this.totalNominalSettlementPrice=t}}},S=v,O=Object(f["a"])(S,g,y,!1,null,null,null),C=O.exports,L=i("1172");function j(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function w(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?j(Object(i),!0).forEach((function(e){Object(a["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var _={name:"editFinishProduct",components:{editFinishProductDialog:P,editFinishProductTable:C},data:function(){return{orderId:this.$route.params.orderId,orderCode:this.$route.params.orderCode,productionOrderId:this.$route.params.productionOrderId,orderType:this.$route.params.orderType,pricedataForm:{kjlAuditName:"",orderCode:"",totalRetailPrice:0},totalPrice:0,totalSupplyPrice:0,totalNominalSettlementPrice:0,productLists:[],flag:!1,tablePro:[]}},mounted:function(){Object(L["a"])(this.$refs.wrapper)},created:function(){this.getFinishProductDetail()},methods:w({},Object(l["c"])({closeCurrentPage:"CLOSE_CURRENT_PAGE"}),{selectProduct:function(t){this.$refs["edit-finish-product-dialog"].openDialog()},getFinishProductDetail:function(){var t=this,e=this.productionOrderId;Object(s["z"])({productionOrderId:e}).then((function(e){if(200===e.code&&e.success){var i=e.data;t.pricedataForm=w({},i),t.totalPrice=i.totalRetailPrice,t.totalSupplyPrice=i.totalSupplyPrice,t.totalNominalSettlementPrice=i.totalNominalSettlementPrice;var r=i.orderOfferList;r&&r.map((function(t){t.id=t.productLibId})),t.productLists=r,t.flag=!0}}))},tableEmitSelectChange:function(t){var e=t.totalPrice,i=void 0===e?0:e,r=t.totalSupplyPrice,o=void 0===r?0:r,a=t.totalNominalSettlementPrice,c=void 0===a?0:a,l=t.tablePro,s=void 0===l?[]:l;this.totalPrice=i,this.totalSupplyPrice=o,this.totalNominalSettlementPrice=c,this.tablePro=s},dialogEmitSelect:function(t){var e=this,i=t.data;i instanceof Array&&i.forEach((function(t){var i=Object(c["h"])(e.productLists,t.id);-1!==i?e.updateProduct(i,"count",parseFloat(e.productLists[i].count)+parseFloat(t.count)):e.createProduct(t)}))},updateProduct:function(t,e,i){this.productLists[t]&&(this.$set(this.productLists[t],e,i),this.clacTotalPrice(),this.calcTotalSupplyPrice(),this.calcTotalNominalSettlementPrice())},createProduct:function(t){this.productLists.push(t),this.clacTotalPrice(),this.calcTotalSupplyPrice(),this.calcTotalNominalSettlementPrice()},tabelEmitChange:function(t){var e=t.data;e instanceof Array&&(this.computedMoney(e),this.productListsSelected(e),this.closeCurrentPage())},dataFormSubmit:function(){var t=this,e=[],i=this.tablePro.length?this.tablePro:this.productLists;i.map((function(t){e.push({productLibId:t.productLibId||t.id,count:t.count,retailPriceUnit:t.retailPrice*t.count,supplyPriceUnit:t.supplyPrice?t.supplyPrice*t.count:0,nominalSettlementPriceUnit:t.nominalSettlementPrice*t.count})}));var r={orderId:this.orderId,kjlAuditName:this.pricedataForm.kjlAuditName,totalRetailPrice:this.totalPrice,productLibs:JSON.stringify(e),totalSupplyPrice:this.totalSupplyPrice,totalNominalSettlementPrice:this.totalNominalSettlementPrice,productionOrderId:this.productionOrderId};if(e.length){var o=this;this.$refs["pricedataForm"].validate((function(e){e&&Object(s["r"])(r).then((function(e){200===e.code&&e.success&&(t.$message.success("操作成功"),t.closeCurrentPage(t.$route.fullPath),o.editHandleRoute())}))}))}else this.$message.warning("请先勾选产品")},editHandleRoute:function(){this.$router.push({path:"/order/editCad/".concat(this.orderId,"/1")})},clacTotalPrice:function(){for(var t=0,e=this.productLists.length,i=0;i<e;i++)t+=this.productLists[i].count*this.productLists[i].retailPrice;this.totalPrice=t},calcTotalSupplyPrice:function(){for(var t=0,e=this.productLists.length,i=0;i<e;i++)this.productLists[i].supplyPrice?t+=this.productLists[i].count*this.productLists[i].supplyPrice:t=0;this.totalSupplyPrice=t},calcTotalNominalSettlementPrice:function(){for(var t=0,e=this.productLists.length,i=0;i<e;i++)t+=this.productLists[i].count*this.productLists[i].nominalSettlementPrice;this.totalNominalSettlementPrice=t}})},F=_,k=(i("0862"),Object(f["a"])(F,r,o,!1,null,"52d02c54",null));e["default"]=k.exports},"1d8f":function(t,e,i){"use strict";var r=i("8a9d"),o=i.n(r);o.a},"473b":function(t,e,i){},"8a9d":function(t,e,i){}}]);